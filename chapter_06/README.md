# Chapter 06. Applied WebAssembly: Legacy Code in the Browser

This chapter introduces usage of Emscripten (LLVM platform based) toolchain.

## "Hello, World!" using Emscripten

> Note: In this chapter we will need multiple dependencies. Using the `nix-shell` approach
> and the Git repository from the main [README.md](../README.md) file, we could set-up our
> environment as follows:

```shell
~/repos/bash-utils/nix/dynamic-nix-shell.sh compiled js
unpacking 'https://github.com/NixOS/nixpkgs/archive/035f8c0853c2977b24ffc4d0a42c74f00b182cd8.tar.gz' into the Git cache...
info: using existing install for 'stable-x86_64-unknown-linux-gnu'
info: default toolchain set to 'stable-x86_64-unknown-linux-gnu'

  stable-x86_64-unknown-linux-gnu unchanged - rustc 1.79.0 (129f3b996 2024-06-10)
```

Using the Emscripten C compiler, we tell it to compile the C code and generate
some JavaScript scaffolding. After that we may run the resuling file in Node.js:

```shell
emcc hello.c -o hello.js
cache:INFO: generating system headers: sysroot_install.stamp... (this will be cached in "/home/vasilegorcinschi/.emscripten_cache/sysroot_install.stamp" for subsequent builds)
cache:INFO:  - ok
...
system_libs:INFO: compiled 27 inputs in 0.64s
cache:INFO:  - ok
cache:INFO: generating system asset: symbol_lists/de03afcd05285bf3a092555b24db5682ffadd7d5.json... (this will be cached in "/home/vasilegorcinschi/.emscripten_cache/symbol_lists/de03afcd05285bf3a092555b24db5682ffadd7d5.json" for subsequent builds)
cache:INFO:  - ok
[nix-shell:~/repos/wasm_definitive_guide/chapter_06]$ ls -halF | grep hello
-rw-rw-r--  1 vasilegorcinschi vasilegorcinschi   76 Jan 25 16:41 hello.c
-rw-r--r--  1 vasilegorcinschi vasilegorcinschi  54K Jan 25 16:49 hello.js
-rwxr-xr-x  1 vasilegorcinschi vasilegorcinschi  15K Jan 25 16:49 hello.wasm*
[nix-shell:~/repos/wasm_definitive_guide/chapter_06]$ node hello.js
Hello, World!
```

### Link common JS and CSS files

```shell
cd chapter_06/
# supposing you are in chapter_02 folder already
ln -s ../common common
```

### Run the generated `hello.js` file in the browser

To preview [hello.html](hello.html) file that runs [hello.wasm](hello.wasm) file the instructed step is:

```shell
# assumes presence of python3 on your host system
python3 -m http.server 10003
```

Then navigate to `localhost:10003/hello.html`. It is noteworthy, that with the code generated by Emscripten
we no longer needed to import the previously used [utils.js](common/utils.js).

## Bitmap project

Project under [bitmap](./bitmap) directory showcases porting an exsting (third-party) application to WebAssembly.

Emscripten has "drop-in replacements" for tools like `cc`, `make`, and `configure`. The book's author, Brian Sletten,
has chosen [Arash Partow's website](https://www.partow.net/) to pick from a collection of useful C++ code.
